// src/utils/repetitionPhrases.ts

export const REPETITION_PHRASES: Record<string, string[]> = {
  // English repetition phrases
  "en": [
    "what", "what?", "pardon", "pardon?", "sorry", "sorry?", "repeat", "repeat that",
    "say again", "again", "again?", "come again", "come again?", "excuse me", "excuse me?",
    "i didn't catch that", "i didn't hear that", "i didn't understand", "i missed that",
    "one more time", "please repeat", "please repeat that", "could you repeat that",
    "could you say that again", "i beg your pardon", "huh", "huh?", "sorry, what?",
    "what was that", "can you repeat that", "didn't get that", "say that again"
  ],
  // Spanish repetition phrases
  "es": [
    "qué", "¿qué?", "qué?", "perdón", "perdón?", "¿perdón?", "repite", "repítelo",
    "repetirlo", "repetir", "otra vez", "de nuevo", "¿cómo?", "como?", "¿perdona?", "perdona", "disculpa",
    "disculpa?", "¿disculpa?", "no entendí", "no entiendo", "no escuché", "no oí",
    "una vez más", "repite por favor", "puedes repetir", "¿puedes repetirlo?",
    "no te escuché", "¿qué dijiste?", "no te entendí", "¿cómo has dicho?",
    "¿podrías repetir?", "repite eso"
  ],
  // French repetition phrases
  "fr": [
    "quoi", "quoi?", "pardon", "pardon?", "excusez-moi", "excusez-moi?", "répétez",
    "répète", "encore", "encore?", "comment", "comment?", "je n'ai pas compris",
    "je ne comprends pas", "je n'ai pas entendu", "une fois de plus", "répétez s'il vous plaît",
    "pouvez-vous répéter", "pourriez-vous répéter", "je vous demande pardon",
    "pourriez-vous répéter cela", "qu'est-ce que vous avez dit", "plaît-il",
    "plaît-il?", "vous pouvez répéter", "peux-tu répéter", "dis-le encore une fois",
    "je n'ai pas saisi", "redis-le", "répète ça"
  ],
  // Italian repetition phrases
  "it": [
    "cosa", "cosa?", "scusa", "scusa?", "mi scusi", "mi scusi?", "ripeti", "ripeta",
    "di nuovo", "ancora", "come", "come?", "non ho capito", "non capisco",
    "non ho sentito", "un'altra volta", "ripeti per favore", "puoi ripetere",
    "potresti ripetere", "mi perdoni", "come hai detto", "che cosa hai detto",
    "prego", "prego?", "puoi dirlo di nuovo", "non ho afferrato", "scusi, cosa?",
    "come hai detto?", "ripetilo", "non ho sentito bene"
  ],
  // German repetition phrases
  "de": [
    "was", "was?", "bitte", "bitte?", "entschuldigung", "entschuldigung?", "wiederholen",
    "wiederholen sie das", "noch einmal", "nochmal", "wie bitte", "wie bitte?",
    "ich habe nicht verstanden", "ich verstehe nicht", "ich habe das nicht gehört",
    "noch einmal bitte", "können sie das wiederholen", "könnten sie das wiederholen",
    "ich bitte um verzeihung", "was haben sie gesagt", "bitte wiederholen sie",
    "können sie das nochmal sagen", "wie war das", "ich habe das nicht mitbekommen"
  ],
  // Portuguese repetition phrases
  "pt": [
    "o que", "o quê?", "perdão", "perdão?", "desculpe", "desculpe?", "repita",
    "repita isso", "diga novamente", "novamente", "novamente?", "como",
    "como?", "não entendi", "não compreendi", "não ouvi", "mais uma vez",
    "por favor, repita", "pode repetir", "poderia repetir", "o que você disse",
    "perdão, o quê?", "não captei", "diga outra vez"
  ],
  // Chinese (Mandarin) repetition phrases
  "zh": [
    "什么", "什么?", "对不起", "对不起?", "请再说一遍", "再说一遍", "再说一次",
    "请重复", "我没听懂", "我听不懂", "我没听清", "请再说一次", "请问您说什么",
    "不好意思", "能再说一遍吗", "请问", "麻烦再说一次"
  ],
  // Japanese repetition phrases
  "ja": [
    "何", "何?", "すみません", "すみません?", "もう一度", "もう一度言ってください",
    "もう一回", "繰り返してください", "わかりません", "聞き取れませんでした",
    "もう一度お願いします", "何と言いましたか", "聞こえませんでした"
  ],
  // Korean repetition phrases
  "ko": [
    "뭐", "뭐라고요?", "죄송합니다", "죄송합니다?", "다시 말씀해 주세요",
    "다시 한번", "다시 한번 말씀해 주시겠어요?", "이해가 안 됩니다",
    "잘 못 들었습니다", "다시 말해주세요", "뭐라고 하셨나요"
  ],
  // Arabic repetition phrases
  "ar": [
    "ماذا", "ماذا؟", "عفوا", "عفوا؟", "أعد من فضلك", "مرة أخرى", "مرة أخرى؟",
    "لم أفهم", "لم أسمع", "هل يمكنك الإعادة", "ماذا قلت", "أعد القول من فضلك"
  ],
  // Hindi repetition phrases
  "hi": [
    "क्या", "क्या?", "माफ़ कीजिए", "माफ़ कीजिए?", "फिर से बताइए", "फिर से",
    "एक बार और", "दोहराइए", "मैंने नहीं समझा", "मैंने नहीं सुना",
    "कृपया दोहराएं", "आपने क्या कहा", "क्षमा करें, क्या?"
  ],
  // Russian repetition phrases
  "ru": [
    "что", "что?", "простите", "простите?", "извините", "извините?", "повторите",
    "повторите, пожалуйста", "еще раз", "еще раз?", "я не понял", "я не слышал",
    "не могли бы вы повторить", "что вы сказали", "прошу прощения"
  ],
  // Dutch repetition phrases
  "nl": [
    "wat", "wat?", "pardon", "pardon?", "sorry", "sorry?", "herhaal",
    "herhaal dat", "nog een keer", "nog eens", "wat zei je", "ik heb het niet begrepen",
    "ik heb je niet gehoord", "kun je dat herhalen", "wat was dat"
  ],
  // Polish repetition phrases
  "pl": [
    "co", "co?", "przepraszam", "przepraszam?", "powtórz", "powtórz to",
    "jeszcze raz", "nie zrozumiałem", "nie usłyszałem", "czy możesz powtórzyć",
    "co powiedziałeś", "słucham", "proszę powtórzyć"
  ],
  // Turkish repetition phrases
  "tr": [
    "ne", "ne?", "affedersin", "affedersin?", "özür dilerim", "özür dilerim?", "tekrar et",
    "tekrarlar mısın", "tekrar", "bir daha", "anlamadım", "duymadım",
    "tekrar söyler misin", "ne dedin"
  ],
  // Hungarian repetition phrases
  "hu": [
    "mit", "mit?", "elnézést", "elnézést?", "ismételje meg", "még egyszer",
    "nem értettem", "nem hallottam", "megismételné", "mit mondott"
  ],
  // Finnish repetition phrases
  "fi": [
    "mitä", "mitä?", "anteeksi", "anteeksi?", "toista", "toista se",
    "uudestaan", "en ymmärtänyt", "en kuullut", "voitko toistaa",
    "mitä sanoit"
  ],
  // Greek repetition phrases
  "el": [
    "τι", "τι;", "συγγνώμη", "συγγνώμη;", "επανάλαβε", "ξανά",
    "δεν κατάλαβα", "δεν άκουσα", "μπορείς να το επαναλάβεις",
    "τι είπες"
  ]
};

/**
 * Checks if a user message is a repetition request
 * @param message The user message to check
 * @param languages Array of language codes to check against, in priority order
 * @returns boolean indicating if it's a repetition request
 */
export function isRepetitionRequest(message: string, languages: string[]): boolean {
  if (!message || !languages || languages.length === 0) {
    return false;
  }

  // Clean the message for comparison
  const cleanedMessage = message.toLowerCase().trim();

  // Check each language in the provided order of priority
  for (const langCode of languages) {
    if (REPETITION_PHRASES[langCode]) {
      for (const phrase of REPETITION_PHRASES[langCode]) {
        // For short phrases (1-2 words), check if it's an exact match
        const words = phrase.split(/\s+/).length;
        if (words <= 2) {
          if (cleanedMessage === phrase.toLowerCase()) {
            return true;
          }
        }

        // Also check if the message contains the phrase and makes up a significant part
        if (cleanedMessage.includes(phrase.toLowerCase())) {
          const wordRatio = phrase.split(/\s+/).length / cleanedMessage.split(/\s+/).length;
          if (wordRatio >= 0.5) { // If phrase is at least 50% of the message
            return true;
          }
        }
      }
    }
  }

  return false;
}

export default {
  REPETITION_PHRASES,
  isRepetitionRequest
};